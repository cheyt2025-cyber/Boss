-- ZAPORIUM GUI - OPTIMIZED v7.0 + CLEAN LAYOUT (Egg farming grouped) --
local library = loadstring(game:HttpGet("https://raw.githubusercontent.com/Zap-Zaporium/Zap-is-Me/refs/heads/main/Zaporium.lua"))()

-- Create main window
local Window = library:CreateWindow("My Fishing Brainrots")

-- Main Features folder (now cleaner)
local Main = Window:AddFolder("Main Features")

-- Egg Farming folder (was Rarity Targets)
local EggFarm = Window:AddFolder("Farm Egg")

-- Auto Spawn Egg Toggle (moved here)
EggFarm:AddToggle({
    text = "Auto Spawn Egg",
    state = false,
    flag = "autospawnegg",
    callback = function(enabled)
        if enabled then
            print("Auto Spawn Egg → Activated")
            spawn(function()
                local ReplicatedStorage = game:GetService("ReplicatedStorage")
                local spawnRemote = ReplicatedStorage
                :WaitForChild("Shared")
                :WaitForChild("Packages")
                :WaitForChild("Networker")
                :WaitForChild("RF/RequestEggSpawn")

                print("Egg Hunter v7.0 - Reliable detection active")

                local raritySet = {
                    ["common"] = "Common",
                    ["uncommon"] = "Uncommon",
                    ["rare"] = "Rare",
                    ["epic"] = "Epic",
                    ["legendary"] = "Legendary",
                    ["mythic"] = "Mythic",
                    ["secret"] = "Secret",
                    ["exotic"] = "Exotic",
                    ["exclusive"] = "Exclusive",
                    ["limited"] = "Limited",
                    ["admin"] = "Admin",
                    ["og"] = "OG",
                    ["xmas 25"] = "XMAS 25",
                    ["xmas25"] = "XMAS25",
                    ["event"] = "Event",
                    ["divine"] = "Divine",
                    ["god"] = "GOD",
                    ["???"] = "???",
                    ["celest"] = "CELEST"
                }

                local eggsFolder = workspace:WaitForChild("CoreObjects"):WaitForChild("Eggs")

                local function getEggRarity(egg)
                    if not egg or not egg.Parent then return "Unknown" end

                    local function quickScan()
                        for _, obj in ipairs(egg:GetDescendants()) do
                            if obj:IsA("TextLabel") or obj:IsA("TextButton") or obj:IsA("SurfaceGui") then
                                local success, text = pcall(function() return obj.Text end)
                                if success and text and text ~= "" then
                                    local textLower = text:lower():gsub("%s+", " "):match("^%s*(.-)%s*$")
                                    if raritySet[textLower] then 
                                        return raritySet[textLower]
                                    end
                                end
                            end
                            local nameLower = obj.Name:lower()
                            if raritySet[nameLower] then 
                                return raritySet[nameLower]
                            end
                        end
                        return nil
                    end

                    local rarity = quickScan()
                    if rarity then return rarity end

                    local pollTime = 0
                    while pollTime < 3 do
                        task.wait(0.2)
                        pollTime = pollTime + 0.2
                        if not egg.Parent then return "Unknown" end
                        rarity = quickScan()
                        if rarity then return rarity end
                    end
                    return "Unknown"
                end

                local function shouldKeepThisRarity(rarityLower)
                    if not rarityLower or rarityLower == "unknown" then return false end
                    local r = rarityLower:gsub("%s+", ""):lower()
                    if r == "legendary" then return library.flags.target_legendary or false end
                    if r == "mythic" then return library.flags.target_mythic or false end
                    if r == "secret" then return library.flags.target_secret or false end
                    if r == "exotic" then return library.flags.target_exotic or false end
                    if r == "event" or r == "limited" or r == "og" or r == "xmas25" or r == "xmas 25" then
                        return library.flags.target_special or false
                    end
                    if r == "divine" or r == "god" or r == "???" or r == "celest" or r == "exclusive" or r == "admin" then
                        return library.flags.target_godly or false
                    end
                    return false
                end

                print("Using ChildAdded detection + extended check")
                local spawnCount = 0
                local sessionTargets = 0

                while library.flags.autospawnegg do
                    spawnCount = spawnCount + 1
                    pcall(function()
                        spawnRemote:InvokeServer()
                    end)

                    local success, newEgg = pcall(function()
                        return eggsFolder.ChildAdded:Wait()
                    end)

                    if not success or not newEgg or not newEgg.Parent then
                        task.wait(0.05)
                        continue
                    end

                    print("#" .. spawnCount .. ": New egg detected → " .. newEgg.Name)

                    task.wait(1.0)
                    local rarity = getEggRarity(newEgg)
                    local rarityLower = rarity:lower()

                    if shouldKeepThisRarity(rarityLower) then
                        sessionTargets = sessionTargets + 1
                        print("\nTARGET RARITY FOUND!")
                        print("Egg: " .. newEgg.Name .. " | Rarity: " .. rarity)
                        print("Spawned: " .. spawnCount .. " | Targets: " .. sessionTargets)
                        print("Paused - buy the egg now\n")

                        repeat task.wait(0.1) until not newEgg.Parent or newEgg.Parent ~= eggsFolder
                        print("Egg bought - resuming\n")
                        task.wait(0.1)
                    else
                        if rarity == "Unknown" then
                            print(" ↳ Unknown - skipped")
                        else
                            print(" ↳ " .. rarity .. " - skipped")
                        end
                    end

                    task.wait(0.01)
                end
            end)
        else
            print("Auto Spawn Egg → Deactivated")
        end
    end
})

-- Description (moved here too)
EggFarm:AddLabel({text = "Auto-spawn eggs"})

-- Rarity selection (inside the same folder)
EggFarm:AddLabel({text = "Pause on selected rarities"})

EggFarm:AddToggle({
    text = "Legendary",
    state = true,
    flag = "target_legendary",
    callback = function() end
})

EggFarm:AddToggle({
    text = "Mythic",
    state = true,
    flag = "target_mythic",
    callback = function() end
})

EggFarm:AddToggle({
    text = "Secret",
    state = true,
    flag = "target_secret",
    callback = function() end
})

EggFarm:AddToggle({
    text = "Exotic",
    state = true,
    flag = "target_exotic",
    callback = function() end
})

EggFarm:AddToggle({
    text = "Events / Limited / OG / XMAS",
    state = true,
    flag = "target_special",
    callback = function() end
})

EggFarm:AddToggle({
    text = "Divine / GOD / Exclusive / Special",
    state = true,
    flag = "target_godly",
    callback = function() end
})

-- Auto Pick Up (stays in Main)
Main:AddToggle({
    text = "Auto Pick Up",
    state = false,
    flag = "autopickup",
    callback = function(enabled)
        if enabled then
            print("Auto Pick Up → Activated (delay: " .. library.flags.pickupdelay .. "s)")
            spawn(function()
                local pickupRemote = game:GetService("ReplicatedStorage")
                :WaitForChild("Shared")
                :WaitForChild("Packages")
                :WaitForChild("Networker")
                :WaitForChild("RE/PickupBoxes")
                while library.flags.autopickup do
                    pcall(function()
                        pickupRemote:FireServer()
                    end)
                    task.wait(library.flags.pickupdelay)
                end
            end)
        else
            print("Auto Pick Up → Deactivated")
        end
    end
})

Main:AddSlider({
    text = "Pick Up Delay (seconds)",
    min = 1,
    max = 60,
    value = 1,
    flag = "pickupdelay",
    callback = function(value)
        print("Pick Up delay set to: " .. value .. "s")
    end
})

Main:AddToggle({
    text = "Auto Rebirth",
    state = false,
    flag = "autorebirth",
    callback = function(enabled)
        if enabled then
            print("Auto Rebirth → Activated")
            spawn(function()
                local rebirthRemote = game:GetService("ReplicatedStorage")
                :WaitForChild("Shared")
                :WaitForChild("Packages")
                :WaitForChild("Networker")
                :WaitForChild("RF/Rebirth")
                while library.flags.autorebirth do
                    pcall(function()
                        rebirthRemote:InvokeServer()
                    end)
                    task.wait(1)
                end
            end)
        else
            print("Auto Rebirth → Deactivated")
        end
    end
})

Main:AddLabel({text = "YT: ScriptZap0"})

library:Init()
print("My Fishing Brainrots GUI loaded – ready")
