local Players = game:GetService("Players")
local VirtualUser = game:GetService("VirtualUser")
local TeleportService = game:GetService("TeleportService")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer

-- Permanent Anti-AFK
LocalPlayer.Idled:Connect(function()
    VirtualUser:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
    task.wait(1)
    VirtualUser:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
end)

-- Load Zaporium UI Library
local Library = loadstring(game:HttpGet('https://raw.githubusercontent.com/cheyt2025-cyber/HAYS-AI/refs/heads/main/ZAPORIUM'))()
local Window = Library.CreateWindow({
    Name = "ZAPORIUM",
    LoadingTitle = "Zaporium",
    ConfigurationSaving = {Enabled = false},
    AccentColor = Color3.fromRGB(0, 212, 255),
    Logo = "rbxassetid://112586636995159",
    Credit = "Created by ScriptZap",
    EnableBooting = true
})

-- Info Tab
local InfoTab = Window:CreateTab("Info")
InfoTab:CreateLabel("Welcome to ZAPORIUM!")
InfoTab:CreateLabel("Thank you so much for using my script!")
InfoTab:CreateLabel("Made with love • Fassion")
InfoTab:CreateLabel("Your support keeps me going!")
InfoTab:CreateLabel("")
InfoTab:CreateLabel("~ ScriptZap")
InfoTab:CreateLabel("ZAPORIUM • Simple, Clean, Powerful")

InfoTab:CreateButton({
    Name = "Join Discord Server",
    Callback = function()
        setclipboard("https://discord.gg/FCwb52g5")
        Window:Notify("Discord link copied to clipboard!", 4)
    end
})

-- OP Farm Tab
local OPFarmTab = Window:CreateTab("OP Farm")

-- ESP Description
OPFarmTab:CreateLabel("Visible through walls • Real-time team colors")
OPFarmTab:CreateLabel("Red = Criminals | Blue = Guards/Police | Orange = Inmates | White = Neutral")

-- ESP Toggle (Fixed & Clean)
local ESPEnabled = false
local Highlights = {}

local GUARD_COLOR    = Color3.fromRGB(0, 162, 255)
local INMATE_COLOR   = Color3.fromRGB(255, 165, 0)
local CRIMINAL_COLOR = Color3.fromRGB(255, 0, 0)
local NEUTRAL_COLOR  = Color3.fromRGB(255, 255, 255)

local function GetTeamColor(plr)
    if not plr.Team then return NEUTRAL_COLOR end
    local t = plr.Team.Name:lower()
    if t:find("criminal") then return CRIMINAL_COLOR
    elseif t:find("guard") or t:find("police") then return GUARD_COLOR
    elseif t:find("inmate") or t:find("prison") then return INMATE_COLOR
    end
    return NEUTRAL_COLOR
end

local function ApplyHighlight(plr)
    if plr == LocalPlayer or not plr.Character then return end
    if Highlights[plr] then Highlights[plr]:Destroy() end
    local hl = Instance.new("Highlight")
    hl.Adornee = plr.Character
    hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    hl.FillTransparency = 1
    hl.OutlineTransparency = 0
    hl.OutlineColor = GetTeamColor(plr)
    hl.Parent = plr.Character
    Highlights[plr] = hl
end

OPFarmTab:CreateToggle({
    Name = "ESP TEAMS",
    Default = false,
    Callback = function(state)
        if state then
            ESPEnabled = true
            for _, p in Players:GetPlayers() do
                if p ~= LocalPlayer and p.Character then
                    ApplyHighlight(p)
                end
            end
            Players.PlayerAdded:Connect(function(p)
                p.CharacterAdded:Connect(function()
                    task.wait(0.3)
                    ApplyHighlight(p)
                end)
            end)
            Window:Notify("Team ESP Enabled!", 3)
        else
            ESPEnabled = false
            for _, hl in pairs(Highlights) do
                if hl then hl:Destroy() end
            end
            Highlights = {}
            Window:Notify("Team ESP Disabled", 3)
        end
    end
})

-- Safe Teleport Function
local function SafeTP(pos)
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character.HumanoidRootPart.CFrame = pos
    end
end

-- Teleport Buttons
OPFarmTab:CreateButton({Name="Police Gun",       Callback=function() SafeTP(CFrame.new(816.25, 99.98, 2221.14)) Window:Notify("Teleported to Police Gun!",3) end})
OPFarmTab:CreateButton({Name="Get Car",          Callback=function() SafeTP(CFrame.new(-525.98, 54.78, 1774.09)) Window:Notify("Teleported to Car Spawn!",3) end})
OPFarmTab:CreateButton({Name="Criminal Base",    Callback=function() SafeTP(CFrame.new(-941.59, 94.13, 2053.98)) Window:Notify("Teleported to Criminal Base!",3) end})
OPFarmTab:CreateButton({Name="Teleport to Yard", Callback=function() SafeTP(CFrame.new(781.90, 98.00, 2465.36)) Window:Notify("Teleported to Yard!",3) end})
OPFarmTab:CreateButton({Name="Teleport to Cafeteria", Callback=function() SafeTP(CFrame.new(921.54, 99.99, 2307.42)) Window:Notify("Teleported to Cafeteria!",3) end})

-- Misc Tab
local MiscTab = Window:CreateTab("Misc")

MiscTab:CreateButton({
    Name = "Hop Server",
    Callback = function()
        Window:Notify("Hopping server...", 3)
        local servers = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/"..game.PlaceId.."/servers/Public?sortOrder=Asc&limit=100"))
        local good = {}
        for _,v in pairs(servers.data) do
            if v.playing < v.maxPlayers and v.id ~= game.JobId then
                table.insert(good, v.id)
            end
        end
        if #good > 0 then
            TeleportService:TeleportToPlaceInstance(game.PlaceId, good[math.random(#good)], LocalPlayer)
        else
            Window:Notify("No servers found!", 4)
        end
    end
})

MiscTab:CreateSlider({
    Name = "WalkSpeed",
    Min = 16,
    Max = 300,
    Default = 16,
    Callback = function(value)
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.WalkSpeed = value
        end
        LocalPlayer.CharacterAdded:Connect(function(char)
            task.wait(0.1)
            local hum = char:FindFirstChild("Humanoid")
            if hum then hum.WalkSpeed = value end
        end)
    end
})

MiscTab:CreateButton({
    Name = "Rejoin Server",
    Callback = function()
        Window:Notify("Rejoining...", 3)
        TeleportService:Teleport(game.PlaceId, LocalPlayer)
    end
})

-- Final notification
Window:Notify("ZAPORIUM Loaded • Anti-AFK + ESP Ready", 6)
